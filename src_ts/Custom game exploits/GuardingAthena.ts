var config = {
		selected_hero: 0,
		selected_item: 0,
		player_ids: [],
	},
	root_: Menu_Node,
	players: Menu_List

Events.addListener("onGameStarted", () => {
	// loop-optimizer: KEEP
	players.values = ((PlayerResource as any).m_vecPlayerData as PlayerResourcePlayerData_t[]).map(data => data.m_iszPlayerName)
	root_.Update()
	players.selected_flags = players.selected_flags.map(val => false) // reset state every game, as it's based on playerIDs
})
Events.addListener("onGameEnded", () => {
	players.values = []
	root_.Update()
})

Events.addListener("onTick", () => {
	if (config.player_ids.length === 0)
		return

})

export default (my_root: Menu_Node, root: Menu_Node) => {
	root_ = root
	my_root.entries.push(players = new Menu_List (
		"Players",
		[],
		config.player_ids,
		self => config.player_ids = self.selected_flags,
	))
	var items_obj = {
			"item_bag_of_gold": "A full bag of gold",
			"item_clarity1": "small-clarity",
			"item_clarity2": "medium-clarity",
			"item_clarity3": "advanced-clarity",
			"item_clarity4": "super-clarity",
			"item_salve1": "small-salve",
			"item_salve2": "medium-salve",
			"item_salve3": "advanced-salve",
			"item_salve4": "super-salve",
			"item_huixue": "small-instant salve",
			"item_huixue1": "medium-instant salve",
			"item_huixue2": "advanced-instant salve",
			"item_huixue3": "super-instanr salve",
			"item_energy_ball": "Magic Ball",
			"item_power_ball": "Strength Ball",
			"item_fantasy_ball": "Agility Ball",
			"item_energy_core": "Magic Nuclear",
			"item_power_core": "Strength Nuclear",
			"item_fantasy_core": "Agility Nuclear",
			"item_original_str_9": "Strength essence",
			"item_original_str_14": "Strength ball",
			"item_original_str_15": "Strength Nuclear",
			"item_original_agi_9": "Agility essence",
			"item_original_agi_14": "Agility ball",
			"item_original_agi_15": "Agility Nuclear",
			"item_original_int_9": "Intellect essence",
			"item_original_int_14": "Intellect ball",
			"item_original_int_15": "Magic Nuclear",
			"item_blades1": "Kitchen knife",
			"item_blades2": "Butcher's knife",
			"item_blades3": "katana",
			"item_blades4": "Sun Sword ",
			"item_blades5": "Noob's Sword",
			"item_jianjiadao": "Blood Axe",
			"item_crit": "the god's weapon",
			"item_blink1": "the honor of stooge",
			"item_chainmail1": "Athena's silk apron",
			"item_chainmail2": "Athena's cloth apron",
			"item_chainmail3": "Athena's Linen apron",
			"item_chainmail4": "Athena's iron apron",
			"item_mokang": "rabbi killer",
			"item_shanbi": "the god's insight",
			"item_point1": "Hercules‘belt",
			"item_refresher1": "refresher",
			"item_shield": "Medusa's shield",
			"item_boots1": "Hermes' Shoes",
			"item_str_book": "strength book",
			"item_agi_book": "agility book",
			"item_int_book": "intellect book",
			"item_jiandun": "One-dimensional foil",
			"item_ronghe": "Fuse",
			"item_npc_dota_hero_windrunner": "Orion’s bow(seals)",
			"item_npc_dota_hero_windrunner1": "Orion’s bow",
			"item_npc_dota_hero_phantom_assassin": "Artemis's weapon(seals)",
			"item_npc_dota_hero_phantom_assassin1": "Artemis's weapon",
			"item_npc_dota_hero_omniknight": "Buddha's  Cassock(seals)",
			"item_npc_dota_hero_omniknight1": "Buddha's  Cassock",
			"item_npc_dota_hero_rubick": "Dreamland Cube(seals)",
			"item_npc_dota_hero_rubick1": "Dreamland Cube",
			"item_npc_dota_hero_antimage": "Death Scythe(seals)",
			"item_npc_dota_hero_antimage1": "Death Scythe",
			"item_blood_mask": "blood mask",
			"item_yunshizhaohuan": "Meteorite core",
			"item_blood_fruit": "Clotho`s blood",
			"item_fazhang_1": "Staff of Wizardry",
			"item_fazhang_2": "Oblivion Staff",
			"item_fazhang_3": "Force Staff",
			"item_fazhang_4": "Rod of Atos",
			"item_fazhang_5": "Diana`s Moon Staff",
			"item_fazhang_6": "The rod of God",
			"item_fazhang_5_clone": "Oblivion Staff",
			"item_shipin_2": "Hephaestus Glove",
			"item_shipin_3": "Heal Ring",
			"item_shipin_4": "Void Stone",
			"item_shipin_5": "Shadow Amulet",
			"item_xie_1": "Boot",
			"item_xie_2": "Tranquil Boots",
			"item_xie_3": "Boots of Travel",
			"item_xie_4": "Boots of Fly",
			"item_xie_5": "Hermes`s Boot",
			"item_jia_1": "Chainmail",
			"item_jia_2": "Blade Mail",
			"item_jia_3": "Platemail",
			"item_jia_4": "Assault Cuirass",
			"item_jia_5": "Athena`s Armor",
			"item_gong_1": "Fangs Bow",
			"item_gong_2": "Eaglesong",
			"item_gong_3": "Nighthawk Bow",
			"item_gong_4": "Ancient Dragon Bow",
			"item_gong_5": "Daedalus Storm Bow",
			"item_jian_6": "Divine Rapier",
			"item_gong_6": "Vienow",
			"item_fumo_jianjia": "Enchant Scroll | Armor Break",
			"item_fumo_mokang": "Enchant Scroll | Resistance Break",
			"item_fumo_baoji": "Enchant Scroll | Critical",
			"item_dun_1": "Barrier Shield",
			"item_shipin_6": "One Direction Foil",
			"item_shipin_7": "Two Direction Foil",
			"item_zhanqi": "Kobold Banner",
			"item_xiongpi": "Bearskin Cloak",
			"item_hexin": "Strange Core",
			"item_zhangu": "Ancient War Drum",
			"item_dun_2": "Dragon Bone Shield",
			"item_dun_3": "Wind Cross Shield",
			"item_dun_4": "Blue Gem Magic Shield",
			"item_dun_5": "Aegis",
			"item_fu_1": "Poleaxe",
			"item_fu_2": "Saw Axe",
			"item_fu_3": "Solar Eye Axe",
			"item_fu_4": "Glyph Axe",
			"item_fu_5": "Hell Lava Axe",
			"item_chui_1": "Stone Hammer",
			"item_chui_2": "Skull Basher",
			"item_chui_3": "Charge Hammer",
			"item_chui_4": "Lightning Hammer",
			"item_chui_5": "Mjollnir",
			"item_shu_1": "Blood Book",
			"item_shu_2": "Life Book",
			"item_shu_3": "Ice Book",
			"item_shu_4": "Fire Book",
			"item_shu_5": "Taboo Book",
			"item_baoshi_1": "Metal Stone",
			"item_baoshi_2": "Earth Stone",
			"item_baoshi_3": "Sea Stone",
			"item_baoshi_4": "Volcano Stone",
			"item_baoshi_5": "Hell Stone",
			"item_craft_fu": "Craft Axe",
			"item_craft_chui": "Craft Hammer",
			"item_craft_shu": "Craft Book",
			"item_ring_1": "Morning Light Ring",
			"item_ring_2": "Gem Ring",
			"item_ring_3": "Demon Ring",
			"item_ring_4": "Medusa Eye",
			"item_ring_5": "Cunning Echo Eye",
			"item_ring_6": "Night Ring",
			"item_ring_shop": "Unknow Ring",
			"item_ring_world": "Genesis Ring",
			"item_ogre_2": "Ogre Armor",
			"item_ogre_3": "Ogre Bracers",
			"item_ogre_4": "Ogre Suit",
			"item_tree_1": "Leaf",
			"item_tree_2": "Tango",
			"item_tree_3": "Branch 1",
			"item_reborn_1": "Proof of Reincarnation",
			"item_jian_1": "Broad Sowrd",
			"item_jian_2": "Claymore",
			"item_jian_3": "Yasha",
			"item_jian_4": "Sange",
			"item_jian_5": "Ares`s Sword",
			"item_jian_7": "Divine Rapier 1",
			"item_jian_8": "Divine Rapier 2",
			"item_jian_9": "Divine Rapier 3",
			"item_fazhang_8": "Rod of God 2",
			"item_fazhang_7": "Rod of God 1",
			"item_fazhang_9": "Rod of God 3",
			"item_gong_7": "Vienow 1",
			"item_gong_8": "Vienow 2",
			"item_gong_9": "Vienow 3",
			"item_butianshi": "NuWa Stone",
			"item_shipin_1": "Hercules Belt",
			"item_craft_dun": "Craft Shield",
			"item_ring_broken": "Broken Secret Ring",
			"item_ring_world_broken": "Broken Genesis Ring",
			"item_ogre_1": "Ogre Stick",
			"item_athena_momian": "Athena Magic Immunity",
			"item_athena_wudi": "Athena Invincible",
			"item_exp_fruit": "The magic of mango",
			"item_gold_fruit": "Fateful cheese/Gold fruit",
			"item_fumo_xixue": "Enchant Scroll | Lifesteal",
			"item_npc_dota_hero_nevermore": "Satanic(seals)",
			"item_npc_dota_hero_juggernaut1": "Muramasa",
			"item_npc_dota_hero_juggernaut": "Muramasa(seals)",
			"item_npc_dota_hero_nevermore1": "Satanic",
			"item_npc_dota_hero_lina": "Orchid Malevolence(seals)",
			"item_npc_dota_hero_lina1": "Orchid Malevolence",
			"item_npc_dota_hero_legion_commander": "WarGod Ji(seals)",
			"item_npc_dota_hero_legion_commander1": "WarGod Ji",
			"item_npc_dota_hero_ember_spirit": "Ember(seals)",
			"item_npc_dota_hero_ember_spirit1": "Ember",
			"item_salve1_pack": "small-salve pack",
			"item_clarity1_pack": "small-clarity pack",
			"item_npc_dota_hero_templar_assassin": "Sunplate(seals)",
			"item_npc_dota_hero_templar_assassin1": "Sunplate",
			"item_tree_4": "Branch 2",
			"item_tree_seed": "Tree seed (sells)",
			"item_npc_dota_hero_crystal_maiden": "Crescent Ornament(seals)",
			"item_npc_dota_hero_crystal_maiden1": "Crescent Ornament",
			"item_agi_book_pack": "agility book pack",
			"item_int_book_pack": "intellect book pack",
			"item_str_book_pack": "strength book pack",
			"item_ring_secret": "Secret Ring",
			"item_zhuanshu": "Exclusive Equipment",
			"item_athena_guard": "Athena Magic Immunity",
			"item_battlefury_ring": "Meteorite ring of battlefury",
			"item_aura_4": "Particle 4",
			"item_aura_5": "Particle 5",
			"item_aura_6": "Particle 6",
			"item_chaos_plate": "Chaos Plate",
			"item_aura_0": "Clear Particle",
			"item_aura_1": "Particle 1",
			"item_aura_2": "Particle 2",
			"item_aura_3": "Particle 3",
		},
		items = Object.entries(items_obj).sort((a, b) => a[1].localeCompare(b[1]))
	// loop-optimizer: KEEP
	var items_values = items.map(([key, value]) => value)
	// loop-optimizer: KEEP
	var items_keys = items.map(([key]) => key)
	my_root.entries.push(chosen_hero = new Menu_Combo (
		"Item",
		["None", ...items_values],
		config.selected_item,
		self => config.selected_item = self.selected_id,
	))
	my_root.entries.push(new Menu_Toggle (
		"Give item to players",
		false,
		self => {
			self.value = false
			if (!IsInGame() || config.selected_item <= 0)
				return
			var selected_item_name = items_keys[config.selected_item - 1]
			Entities.GetAllEntities().filter(ent => ent instanceof C_DOTA_BaseNPC && ent.m_bIsValid).forEach((ent: C_DOTA_BaseNPC_Hero) => {
				let controllable = false
				for (let pl in config.player_ids)
					if (controllable = (config.player_ids[pl] && ent.IsControllableByPlayer(parseInt(pl))))
						break
				if (!controllable)
					return
				GameEvents.FireEventToServer("UI_BuyItem", {
					entindex: ent.m_iID,
					itemName: selected_item_name,
					cost: 0,
					type: "",
				})
			})
		},
	))
	var heroes = [
		"npc_dota_hero_antimage",
		"npc_dota_hero_axe",
		"npc_dota_hero_bane",
		"npc_dota_hero_bloodseeker",
		"npc_dota_hero_crystal_maiden",
		"npc_dota_hero_drow_ranger",
		"npc_dota_hero_earthshaker",
		"npc_dota_hero_juggernaut",
		"npc_dota_hero_mirana",
		"npc_dota_hero_nevermore",
		"npc_dota_hero_morphling",
		"npc_dota_hero_phantom_lancer",
		"npc_dota_hero_puck",
		"npc_dota_hero_pudge",
		"npc_dota_hero_razor",
		"npc_dota_hero_sand_king",
		"npc_dota_hero_storm_spirit",
		"npc_dota_hero_sven",
		"npc_dota_hero_tiny",
		"npc_dota_hero_vengefulspirit",
		"npc_dota_hero_windrunner",
		"npc_dota_hero_zuus",
		"npc_dota_hero_kunkka",
		"npc_dota_hero_lina",
		"npc_dota_hero_lich",
		"npc_dota_hero_lion",
		"npc_dota_hero_shadow_shaman",
		"npc_dota_hero_slardar",
		"npc_dota_hero_tidehunter",
		"npc_dota_hero_witch_doctor",
		"npc_dota_hero_riki",
		"npc_dota_hero_enigma",
		"npc_dota_hero_tinker",
		"npc_dota_hero_sniper",
		"npc_dota_hero_necrolyte",
		"npc_dota_hero_warlock",
		"npc_dota_hero_beastmaster",
		"npc_dota_hero_queenofpain",
		"npc_dota_hero_venomancer",
		"npc_dota_hero_faceless_void",
		"npc_dota_hero_skeleton_king",
		"npc_dota_hero_death_prophet",
		"npc_dota_hero_phantom_assassin",
		"npc_dota_hero_pugna",
		"npc_dota_hero_templar_assassin",
		"npc_dota_hero_viper",
		"npc_dota_hero_luna",
		"npc_dota_hero_dragon_knight",
		"npc_dota_hero_dazzle",
		"npc_dota_hero_rattletrap",
		"npc_dota_hero_leshrac",
		"npc_dota_hero_furion",
		"npc_dota_hero_life_stealer",
		"npc_dota_hero_dark_seer",
		"npc_dota_hero_clinkz",
		"npc_dota_hero_omniknight",
		"npc_dota_hero_enchantress",
		"npc_dota_hero_huskar",
		"npc_dota_hero_night_stalker",
		"npc_dota_hero_broodmother",
		"npc_dota_hero_bounty_hunter",
		"npc_dota_hero_weaver",
		"npc_dota_hero_jakiro",
		"npc_dota_hero_batrider",
		"npc_dota_hero_chen",
		"npc_dota_hero_spectre",
		"npc_dota_hero_doom_bringer",
		"npc_dota_hero_ancient_apparition",
		"npc_dota_hero_ursa",
		"npc_dota_hero_spirit_breaker",
		"npc_dota_hero_gyrocopter",
		"npc_dota_hero_alchemist",
		"npc_dota_hero_invoker",
		"npc_dota_hero_silencer",
		"npc_dota_hero_obsidian_destroyer",
		"npc_dota_hero_lycan",
		"npc_dota_hero_brewmaster",
		"npc_dota_hero_shadow_demon",
		"npc_dota_hero_lone_druid",
		"npc_dota_hero_chaos_knight",
		"npc_dota_hero_meepo",
		"npc_dota_hero_treant",
		"npc_dota_hero_ogre_magi",
		"npc_dota_hero_undying",
		"npc_dota_hero_rubick",
		"npc_dota_hero_disruptor",
		"npc_dota_hero_nyx_assassin",
		"npc_dota_hero_naga_siren",
		"npc_dota_hero_keeper_of_the_light",
		"npc_dota_hero_wisp",
		"npc_dota_hero_visage",
		"npc_dota_hero_slark",
		"npc_dota_hero_medusa",
		"npc_dota_hero_troll_warlord",
		"npc_dota_hero_centaur",
		"npc_dota_hero_magnataur",
		"npc_dota_hero_shredder",
		"npc_dota_hero_bristleback",
		"npc_dota_hero_tusk",
		"npc_dota_hero_skywrath_mage",
		"npc_dota_hero_abaddon",
		"npc_dota_hero_elder_titan",
		"npc_dota_hero_legion_commander",
		"npc_dota_hero_ember_spirit",
		"npc_dota_hero_earth_spirit",
		"npc_dota_hero_terrorblade",
		"npc_dota_hero_phoenix",
		"npc_dota_hero_oracle",
		"npc_dota_hero_techies",
		"npc_dota_hero_target_dummy",
		"npc_dota_hero_winter_wyvern",
		"npc_dota_hero_arc_warden",
		"npc_dota_hero_abyssal_underlord",
		"npc_dota_hero_monkey_king",
		"npc_dota_hero_pangolier",
		"npc_dota_hero_dark_willow",
		"npc_dota_hero_grimstroke",
	].sort()
	// loop-optimizer: KEEP
	var heroes_normalized = heroes.map(hero => {
		switch (hero) {
			case "npc_dota_hero_shredder":
				return "timbersaw"
			case "npc_dota_hero_nevermore":
				return "shadow fiend"
			case "npc_dota_hero_obsidian_destroyer":
				return "outworld devourer"
			case "npc_dota_hero_rattletrap":
				return "clockwerk"
			default:
				break
		}
		return hero.substring(14).replace(/_/g, " ")
	})
	var chosen_hero: Menu_Combo
	my_root.entries.push(chosen_hero = new Menu_Combo (
		"Hero",
		// loop-optimizer: KEEP
		["None", ...heroes_normalized],
		config.selected_hero,
		self => config.selected_hero = self.selected_id,
	))
	my_root.entries.push(new Menu_Toggle (
		"Replace hero",
		false,
		self => {
			self.value = false
			if (!IsInGame() || chosen_hero.selected_id <= 0)
				return
			GameEvents.FireEventToServer("hero_selected", {
				hero: heroes[chosen_hero.selected_id - 1],
			})
		},
	))
}
